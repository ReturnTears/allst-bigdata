# Flink

## Flink ç®€ä»‹
```text
Flinkæ˜¯ä»€ä¹ˆ?
Apache Flinkæ˜¯ä¸€ä¸ªæ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å¼•æ“, ç”¨äºå¯¹æ— ç•Œå’Œæœ‰ç•Œæ•°æ®æµè¿›è¡ŒçŠ¶æ€è®¡ç®—ã€‚

Flinkåº”ç”¨åœºæ™¯å¾ˆå¹¿æ³›

ä¸ºä»€ä¹ˆé€‰æ‹©Flink?
Â·æµæ•°æ®æ›´çœŸå®åœ°ååº”äº†æˆ‘ä»¬çš„ç”Ÿæ´»æ–¹å¼
Â·ä¼ ç»Ÿçš„æ•°æ®æ¶æ„æ˜¯åŸºäºæœ‰é™æ•°æ®é›†
Â·æˆ‘ä»¬éœ€è¦çš„ç›®æ ‡:
 ä½å»¶è¿Ÿ
 é«˜åå
 ç»“æœçš„å‡†ç¡®æ€§å’Œè‰¯å¥½çš„å®¹é”™æ€§

é‚£äº›è¡Œä¸šéœ€è¦å¤„ç†æµæ•°æ®?
ç”µå•†å’Œå¸‚åœºè¥é”€ >> æ•°æ®æŠ¥è¡¨ã€å¹¿å‘ŠæŠ•æ”¾ã€ä¸šåŠ¡æµç¨‹éœ€è¦
ç‰©è”ç½‘(IOT) >> ä¼ æ„Ÿå™¨å®æ—¶æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºã€å®æ—¶æŠ¥è­¦ã€äº¤é€šè¿è¾“ä¸š
ç”µä¿¡ä¸š >> åŸºç«™æµé‡è°ƒé…
é“¶è¡Œå’Œé‡‘èä¸š >> å®æ—¶ç»“ç®—å’Œé€šçŸ¥æ¨é€ã€å®æ—¶æ£€æµ‹å¼‚å¸¸è¡Œä¸º

ä¼ ç»Ÿæ•°æ®å¤„ç†æ¶æ„
å‰ç«¯äº‹ä»¶æ“ä½œäº§ç”Ÿæ•°æ® >> Transactional DBMS
äº‹åŠ¡å¤„ç†

åˆ†æå¤„ç†
Transactional DBMS >> ETL Process >> Data Warehouse >> Reports or Ad-HocQueries
å°†æ•°æ®ä»ä¸šåŠ¡æ•°æ®åº“å¤åˆ¶åˆ°æ•°ä»“,å†è¿›è¡Œåˆ†æå’ŒæŸ¥è¯¢

æœ‰çŠ¶æ€çš„æµå¼å¤„ç†
ä¸€ä¸ªä¸€ä¸ªæ•°æ®ç‚¹(å½¢æˆæ•°æ®æµ) >> åº”ç”¨é€»è¾‘ >> æœ¬åœ°çŠ¶æ€(æ–¹ä¾¿æ•…éšœæ¢å¤ > periodic checkpoint) >> Remote Storage

æµå¤„ç†çš„æ¼”å˜
ç”¨ä¸¤å¥—ç³»ç»Ÿ,åŒæ—¶ä¿è¯ä½å»¶è¿Ÿå’Œç»“æœå‡†ç¡®
Event Log >> Batch Layer(Event Importer > Batch Storage > Batch Processor) ä¿è¯äº†å‡†ç¡®æ€§
             or
             Speed Layer(Stream Processor)
          >> Serving Layer (Batch Table and Speed Table) ä¿è¯äº†å®æ—¶æ€§ 
          >> -- (query and merge results) åˆå¹¶ç»“æœ -- >> Application
ä½å»¶è¿Ÿ: Storm (ç¬¬ä¸€ä»£æµå¤„ç†æ¡†æ¶)
é«˜åå: Spark Streaming (ç¬¬äºŒä»£æµå¤„ç†æ¡†æ¶), è¿˜æ˜¯æŒ‰ç…§æ‰¹æ¬¡æ¥å¤„ç†æ•°æ®æµçš„
Flink (ç¬¬ä¸‰ä»£æµå¤„ç†æ¡†æ¶)

Flinkçš„ä¸»è¦ç‰¹ç‚¹
1ã€äº‹ä»¶é©±åŠ¨(Event-driver)
2ã€åœ¨Flinkçš„ä¸–ç•Œè§‚é‡Œé¢ï¼Œä¸€åˆ‡éƒ½æ˜¯æµç»„æˆçš„ï¼Œç¦»çº¿æ•°æ®æ˜¯æœ‰ç•Œçš„æµï¼Œå®æ—¶æ•°æ®æ˜¯ä¸€ä¸ªæ²¡æœ‰ç•Œé™çš„æµï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æœ‰ç•Œæµå’Œæ— ç•Œæµ 
  æœ‰ç•Œæµ: bounded stream
  æ— ç•Œæµ: unbounded stream
  æ‰¹å¤„ç†å°±æ˜¯ç‰¹æ®Šçš„æµå¤„ç†
3ã€åˆ†å±‚API
  è¶Šé¡¶å±‚è¶ŠæŠ½è±¡ï¼Œè¡¨è¾¾å«ä¹‰è¶Šç®€æ˜ï¼Œä½¿ç”¨è¶Šæ–¹ä¾¿
  è¶Šåº•å±‚è¶Šå…·ä½“ï¼Œè¡¨è¾¾èƒ½åŠ›è¶Šä¸°å¯Œï¼Œä½¿ç”¨è¶Šçµæ´»
  High Level Analytics API (SQL / Table API(dynamic tables))
  Stream & Batch Data Processing (DataStream API (streams, windows))
  Stateful Event - Driven Applications (ProcessFunction (events, state,time))
4ã€æ”¯æŒäº‹ä»¶æ—¶é—´(event-time) å’Œå¤„ç†æ—¶é—´(processing-time)è¯­ä¹‰
5ã€ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly-onceï¼‰çš„çŠ¶æ€ä¸€è‡´æ€§ä¿è¯
6ã€ä½å»¶è¿Ÿï¼Œé«˜ååï¼Œæ¯ç§’å¤„ç†ç™¾ä¸‡ä¸ªäº‹ä»¶ã€æ¯«ç§’çº§å»¶è¿Ÿ
7ã€ä¸ä¼—å¤šå¸¸ç”¨å­˜å‚¨ç³»ç»Ÿè¿›è¡Œè¿æ¥
8ã€é«˜å¯ç”¨ï¼ŒåŠ¨æ€æ‰©å±•ï¼Œå®ç°7*24å°æ—¶å…¨å¤©å€™è¿è¡Œ

Flink VS Spark Streaming
æµå’Œå¾®æ‰¹
æ•°æ®æ¨¡å‹
    sparké‡‡ç”¨çš„RDDæ¨¡å‹ï¼ŒSpark Streamingçš„DStreamå®é™…ä¸Šä¹Ÿå°±æ˜¯ä¸€ç»„ç»„å°æ‰¹æ•°æ®RDDçš„é›†åˆ
    flinkåŸºæœ¬æ•°æ®æ¨¡å‹æ˜¯æ•°æ®æµï¼Œä»¥åŠäº‹ä»¶åºåˆ—
è¿è¡Œæ—¶æ¶æ„
    sparkæ˜¯æ‰¹è®¡ç®—ï¼Œå°†DAGåˆ’åˆ†ä¸ºä¸åŒçš„stageï¼Œä¸€ä¸ªå®Œæˆåæ‰å¯ä»¥è®¡ç®—ä¸‹ä¸€ä¸ª
    flinkæ˜¯æ ‡å‡†çš„æµæ‰§è¡Œæ¨¡å¼ï¼Œä¸€ä¸ªäº‹ä»¶åœ¨ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†å®Œæˆåå¯ä»¥ç›´æ¥æ³•ç½‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œå¤„ç†

Flinkå‘½ä»¤è¡Œæäº¤ä½œä¸š:
./bin/flink run -c xxx.*.xxxï¼ˆæŒ‡å®šæäº¤çš„ç±»ï¼‰ -p 2 ï¼ˆå¹¶è¡Œåº¦ï¼‰ /xxx/xxx/*.jar --host master --port 1234
Flinkå‘½ä»¤è¡Œå–æ¶ˆä½œä¸šæäº¤:
./bin/flink cancel JobId ï¼ˆjob idï¼‰
Flinkå‘½ä»¤è¡ŒæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ä½œä¸š
./bin/flink list
Flinkå‘½ä»¤è¡ŒæŸ¥çœ‹æ‰€æœ‰çš„ä½œä¸š
./bin/flink list -a

Flinkå‘½ä»¤è¡Œå¯åŠ¨flinké›†ç¾¤
./bin/start-cluster.sh
Flinkå‘½ä»¤è¡Œåœæ­¢flinké›†ç¾¤
./bin/stop-cluster.sh

Yarnæ¨¡å¼éƒ¨ç½²Flink
Flink on Yarn
Flinkæä¾›äº†ä¸¤ç§åœ¨yarnä¸Šè¿è¡Œçš„æ¨¡å¼ï¼Œ åˆ†åˆ«ä¸ºsession-clusterå’Œper-job-clusteræ¨¡å¼
session-clusteræ¨¡å¼:
    session-clusteræ¨¡å¼éœ€è¦å…ˆå¯åŠ¨é›†ç¾¤ï¼Œ ç„¶åå†æäº¤ä½œä¸šï¼Œ æ¥ç€ä¼šå‘yarnç”³è¯·ä¸€å—ç©ºé—´åï¼Œ èµ„æºæ°¸è¿œä¿æŒä¸å˜ã€‚
  å¦‚æœèµ„æºæ»¡äº†ï¼Œ ä¸‹ä¸€ä¸ªä½œä¸šå°±æ— æ³•æäº¤ï¼Œåªèƒ½ç­‰åˆ°yarnä¸­çš„å…¶ä¸­ä¸€ä¸ªä½œä¸šæ‰§è¡Œå®Œæˆåï¼Œé‡Šæ”¾äº†èµ„æºï¼Œ ä¸‹ä¸ªä½œä¸šæ‰ä¼šæ­£å¸¸æäº¤ã€‚
  æ‰€æœ‰ä½œä¸šå…±äº«Dispatcherå’ŒResourceManagerï¼Œå…±äº«èµ„æºï¼Œ é€‚åˆè§„æ¨¡å°æ‰§è¡Œæ—¶é—´çŸ­çš„ä½œä¸šã€‚
  åœ¨yarnä¸­åˆå§‹åŒ–ä¸€ä¸ªflinké›†ç¾¤ï¼Œå¼€è¾ŸæŒ‡å®šçš„èµ„æºï¼Œ ä»¥æäº¤ä½œä¸šéƒ½å‘è¿™é‡Œæäº¤ã€‚è¿™ä¸ªflinké›†ç¾¤ä¼šå¸¸é©»yarnè«ç¾¤ä¸­ï¼Œé™¤éæ‰‹å·¥åœæ­¢ã€‚
session-clusteræ¨¡å¼å¯åŠ¨è¿‡ç¨‹:
1ã€å¯åŠ¨Hadoopé›†ç¾¤
2ã€./bin/yarn-seesion.sh -n 2 -s 2 -jm 1024 -tm 1024 -nm test -d
    -n è¡¨ç¤ºtaskmanageræ•°é‡
    -s è¡¨ç¤ºtaskmanagerçš„slotæ•°é‡ï¼Œ é»˜è®¤ä¸€ä¸ªslotä¸€ä¸ªcore
    -jm è¡¨ç¤ºJobmanagerçš„å†…å­˜ï¼Œ MB
    -tm è¡¨ç¤ºæ¯ä¸ªtaskmanagerçš„å†…å­˜ï¼Œ MB
    -nm è¡¨ç¤ºyarnçš„appName
    -d è¡¨ç¤ºåå°æ‰§è¡Œ
3ã€æäº¤ä»»åŠ¡ï¼Œ åŒ >> Flinkå‘½ä»¤è¡Œæäº¤ä½œä¸š
4ã€å¯ä»¥å»yarnæ§åˆ¶å°æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
5ã€å–æ¶ˆyarn-session
    yarn application --kill id ï¼ˆè¿™é‡Œçš„idæ˜¯yarnä¸Šweb uiå‰ç«¯ä¸Šè¿è¡Œä»»åŠ¡çš„idï¼‰

per-job-clusteræ¨¡å¼:
    ä¸€ä¸ªjobä¼šå¯¹åº”ä¸€ä¸ªé›†ç¾¤ï¼Œ æ¯æäº¤ä¸€ä¸ªä½œä¸šä¼šæ ¹æ®è‡ªèº«çš„æƒ…å†µéƒ½ä¼šå•ç‹¬å‘yarnç”³è¯·èµ„æºï¼Œç›´åˆ°ä½œä¸šæ‰§è¡Œå®Œæˆã€‚ä¸€ä¸ªä½œä¸šçš„å®Œæˆ
  å¹¶ä¸å½±å“ä¸‹ä¸€ä¸ªä½œä¸šçš„æ­£å¸¸æäº¤å’Œè¿è¡Œã€‚ç‹¬å‘Dispatcherå’ŒResourceManagerï¼Œ æŒ‰éœ€è§£é‡Šèµ„æºç”³è¯·ï¼Œé€‚åˆè§„æ¨¡å¤§ï¼Œè¿è¡Œæ—¶é—´é•¿çš„ä½œä¸šã€‚
  æ¯æ¬¡æäº¤éƒ½ä¼šå¸¸è§ä¸€ä¸ªæ–°çš„flinké›†ç¾¤ï¼Œä»»åŠ¡ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹ååˆ›å»ºçš„é›†ç¾¤ä¹Ÿä¼šæ¶ˆå¤±ã€‚

per-job-clusteræ¨¡å¼å¯åŠ¨æµç¨‹ï¼š
1ã€å¯åŠ¨Hadoopé›†ç¾¤
2ã€ä¸å¯åŠ¨yarn-session, ç›´æ¥æ‰§è¡Œjob
./bin/flink run -m yarn-cluster -c xxx (æ‰§è¡Œç¨‹åºçš„ç±») xxx.jar --host master --port 1234
é‡ç‚¹ï¼š-m yarn-cluster
```

## Flink è¿è¡Œæ¶æ„
```text
ğŸ˜ŠğŸ˜ŠğŸ˜Š Flinkè¿è¡Œæ—¶çš„ç»„ä»¶
o(*ï¿£â–½ï¿£*)ãƒ– JobManager
ä½œä¸šç®¡ç†å™¨:
1ã€æ§åˆ¶ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰§è¡Œçš„ä¸»è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½ä¼šè¢«ä¸€ä¸ªä¸åŒçš„JobManageræ‰€æ§åˆ¶æ‰§è¡Œ
2ã€JobManagerä¼šå…ˆæ¥æ”¶åˆ°è¦æ‰§è¡Œçš„åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºä¼šåŒ…æ‹¬ï¼š
    ä½œä¸šå›¾(JobGraph)ã€
    é€»æ•°æ®æµå›¾(logical dataflow graph)
    å’Œæ‰“åŒ…äº†æ‰€æœ‰çš„ç±»ã€åº“å’Œå…¶ä»–èµ„æºçš„jaråŒ…ã€‚
3ã€JobManagerä¼šæŠŠJobGraphè½¬æ¢æˆä¸€ä¸ªç‰©ç†å±‚é¢çš„æ•°æ®æµå›¾ï¼Œè¿™ä¸ªå›¾è¢«å«åšâ€œæ‰§è¡Œå›¾â€(ExecutionGraph), åŒ…å«äº†æ‰€æœ‰å¯ä»¥å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚
4ã€JobManagerä¼šå‘èµ„æºç®¡ç†å™¨(ResourceManager)è¯·æ±‚æ‰§è¡Œä»»åŠ¡å¿…è¦çš„èµ„æºï¼Œ ä¹Ÿå°±æ˜¯ä»»åŠ¡ç®¡ç†(TaskManager)ä¸Šçš„æ’æ§½(slot)ã€‚
    ä¸€æ—¦å®ƒè·å–åˆ°äº†è¶³å¤Ÿçš„èµ„æºï¼Œå°±ä¼šå°†æ‰§è¡Œå›¾åˆ†å‘åˆ°çœŸæ­£æ‰§è¡Œä»–ä»¬çš„TaskManagerä¸Šï¼Œ è€Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œ 
    JobManagerä¼šè´Ÿè´£æ‰€æœ‰éœ€è¦ä¸­å¤®åè°ƒçš„æ“ä½œï¼Œï¼Œæ¯”å¦‚è¯´æ£€æŸ¥ç‚¹checkpointçš„åè°ƒã€‚

o(*ï¿£â–½ï¿£*)ãƒ– TaskManager
ä»»åŠ¡ç®¡ç†å™¨: TaskManageræ˜¯ä¸»è¦å¹²æ´»çš„
1ã€Flinkçš„å·¥ä½œè¿›ç¨‹ã€‚é€šå¸¸åœ¨Flinkä¸­ä¼šæœ‰å¤šä¸ªTaskManagerè¿è¡Œï¼Œ æ¯ä¸€ä¸ªTaskManageréƒ½åŒ…å«äº†ä¸€å®šæ•°é‡çš„æ’æ§½(slot).
   æ’æ§½çš„æ•°é‡é™åˆ¶äº†TaskManagerèƒ½å¤Ÿæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ã€‚
2ã€å¯åŠ¨ä¹‹åï¼ŒTaskManagerä¼šå‘èµ„æºç®¡ç†å™¨æ³¨å†Œå®ƒçš„æ’æ§½ï¼Œå—åˆ°èµ„æºç®¡ç†å™¨çš„æŒ‡ä»¤åï¼ŒTaskManagerå°±ä¼šå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ’æ§½æä¾›ç»™JobManagerè°ƒç”¨ã€‚
   JobManagerå°±å¯ä»¥å‘æ’æ§½åˆ†é…tasksæ¥æ‰§è¡Œã€‚
3ã€åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œ ä¸€ä¸ªTaskManagerå¯ä»¥è·Ÿå…¶ä»–è¿è¡ŒåŒä¸€åº”ç”¨ç¨‹åºçš„TaskManageräº¤æ¢æ•°æ®

o(*ï¿£â–½ï¿£*)ãƒ– ResourceManager
èµ„æºç®¡ç†å™¨:
1ã€ä¸»è¦è´Ÿè´£ç®¡ç†ä»»åŠ¡ç®¡ç†å™¨(TaskManager)çš„æ’æ§½(slot)ï¼ŒTaskManageræ’æ§½æ˜¯flinkä¸­å®šä¹‰çš„å¤„ç†èµ„æºå•å…ƒã€‚
2ã€Flinkä¸ºä¸åŒçš„ç¯å¢ƒå’Œèµ„æºç®¡ç†å·¥å…·æä¾›äº†ä¸åŒèµ„æºç®¡ç†å™¨ï¼Œæ¯”å¦‚YARNã€Mesosã€K8sä»¥åŠstandaloneéƒ¨ç½²/
3ã€å½“JobManagerç”³è¯·æ’æ§½èµ„æºæ˜¯ï¼Œ ResourceManagerä¼šå°†æœ‰ç©ºé—²æ’æ§½çš„TaskManageråˆ†é…ç»™JobManagerã€‚
   å¦‚æœResourceManageræ²¡æœ‰è¶³å¤Ÿçš„æ’æ§½æ¥æ»¡è¶³JobManagerçš„è¯·æ±‚ï¼Œ å®ƒè¿˜å¯ä»¥å‘èµ„æºæä¾›å¹³å°å‘èµ·ä¼šè¯ï¼Œ ä»¥æä¾›å¯åŠ¨TaskManagerè¿›ç¨‹çš„å®¹å™¨ã€‚

o(*ï¿£â–½ï¿£*)ãƒ– Dispatcherï¼ˆåˆ†å‘å™¨ï¼‰
1ã€å¯ä»¥è·¨ä½œä¸šè¿è¡Œï¼Œ å®ƒä¸ºåº”ç”¨æäº¤æä¾›äº†RESTæ¥å£
2ã€å½“ä¸€ä¸ªåº”ç”¨è¢«æäº¤æ‰§è¡Œæ—¶ï¼Œåˆ†å‘å™¨å°±ä¼šå¯åŠ¨å¹¶å°†åº”ç”¨ç§»äº¤ç»™ä¸€ä¸ªJobManager
3ã€Dispatcherä¹Ÿä¼šå¯åŠ¨ä¸€ä¸ªweb uiï¼Œ ç”¨æ¥æ–¹ä¾¿å±•ç¤ºå’Œç›‘æ§ä½œä¸šæ‰§è¡Œçš„ä¿¡æ¯
4ã€Dispatcheråœ¨æ¶æ„ä¸­å¯èƒ½å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œè¿™å–å†³äºåº”ç”¨æäº¤è¿è¡Œçš„æ–¹å¼

å¹¶è¡Œåº¦(Parallelism):
ä¸€ä¸ªç‰¹å®šç®—å­çš„å­ä»»åŠ¡(subtask)çš„ä¸ªæ•°è¢«ç§°ä¹‹ä¸ºå…¶å¹¶è¡Œåº¦(Parallelism)ã€‚
ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªstreamçš„å¹¶è¡Œåº¦ï¼Œå¯ä»¥è®¤ä¸ºå°±æ˜¯å…¶æ‰€æœ‰ç®—å­ä¸­æœ€å¤§çš„å¹¶è¡Œåº¦ã€‚

TaskManagerå’ŒSlots
Flinkä¸­æ¯ä¸€ä¸ªTaskManageréƒ½æ˜¯ä¸€ä¸ªJVMè¿›ç¨‹ï¼Œ ä»–å¯èƒ½ä¼šåœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸Šæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå­ä»»åŠ¡ã€‚
ä¸ºäº†æ§åˆ¶ä¸€ä¸ªTaskManagerèƒ½å¤Ÿæ¥æ”¶å¤šå°‘ä¸ªtaskï¼ŒTaskManageré€šè¿‡task slotæ¥è¿›è¡Œæ§åˆ¶
ï¼ˆä¸€ä¸ªTaskManagerè‡³å°‘æœ‰ä¸€ä¸ªslotï¼‰
é»˜è®¤æƒ…å†µä¸‹ï¼Œflinkå…è®¸å­ä»»åŠ¡å…±äº«slotï¼Œå³ä½¿ä»–ä»¬æ˜¯ä¸åŒçš„ä»»åŠ¡çš„å­ä»»åŠ¡ã€‚è¿™æ ·çš„ç»“æœæ˜¯ï¼Œä¸€ä¸ªslotå¯ä»¥ä¿å­˜ä½œä¸šçš„æ•´ä¸ªç®¡é“ã€‚
Task Slotæ˜¯é™æ€çš„æ¦‚å¿µï¼Œ æ˜¯æŒ‡TaskManagerå…·æœ‰çš„å¹¶å‘æ‰§è¡Œèƒ½åŠ›ã€‚

ç¨‹åºå’Œæ•°æ®æµ(DataFlow)
æ‰€æœ‰çš„Flinkç¨‹åºéƒ½æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆçš„ï¼Œ Sourceï¼Œ Transformation å’ŒSinkã€‚
Sourceè´Ÿè´£è¯»å–æ•°æ®æºï¼Œ Transformationåˆ©ç”¨å„ç§ç®—å­è¿›è¡Œå¤„ç†åŠ å·¥ï¼Œ Sinkè´Ÿè´£è¾“å‡ºã€‚
åœ¨è¿è¡Œæ—¶ï¼Œ Flinkä¸Šè¿è¡Œçš„ç¨‹åºä¼šè¢«æ˜ å°„æˆé€»è¾‘æ•°æ®æµ(dataflows), å®ƒåŒ…å«äº†è¿™ä¸‰éƒ¨åˆ†ã€‚
æ¯ä¸€ä¸ªdataflowä»¥ä¸€ä¸ªæˆ–å¤šä¸ªsourceså¼€å§‹ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªsinksç»“æŸã€‚dataflowç±»ä¼¼äºä»»æ„çš„æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ã€‚
å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç¨‹åºä¸­è½¬æ¢è¿ç®—(transformations)è·Ÿdataflowä¸­çš„ç®—å­ï¼ˆoperatorï¼‰æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚

æ‰§è¡Œå›¾(ExecutionGraph)
Flinkä¸­çš„æ‰§è¡Œå›¾å¯ä»¥åˆ†ä¸ºå››å±‚ï¼šStreamGraph > JobGraph > ExecutionGraph > ç‰©ç†æ‰§è¡Œå›¾
StreamGraph: æ˜¯æ ¹æ®ç”¨æˆ·é€šè¿‡Stream APIç¼–å†™çš„ä»£ç ç”Ÿæˆçš„æœ€åˆçš„å›¾ã€‚ç”¨æ¥è¡¨ç¤ºç¨‹åºçš„æ‹“æ‰‘ç»“æ„
JobGraph: ä½œä¸šå›¾ï¼ŒStreamGraphç»è¿‡ä¼˜åŒ–åç”Ÿæˆäº†JobGraphï¼Œæäº¤ç»™JobManagerçš„æ•°æ®ç»“æ„ã€‚ä¸»è¦çš„ä¼˜åŒ–ä¸ºï¼Œå°†å¤šä¸ªç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹chainåœ¨ä¸€èµ·ä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹ã€‚
ExecutionGraph: JobManageræ ¹æ®JobGraphç”ŸæˆExecutionGraphã€‚
    ExecutionGraphæ˜¯JobGraphçš„å¹¶è¡ŒåŒ–ç‰ˆæœ¬ï¼Œæ˜¯è°ƒåº¦å±‚æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„ã€‚
ç‰©ç†æ‰§è¡Œå›¾ï¼šJobManageræ ¹æ®ExecutionGraphå¯¹Jobè¿›è¡Œè°ƒåº¦åï¼Œåœ¨å„ä¸ªTaskManagerä¸Šéƒ¨ç½²Taskåå½¢æˆçš„â€œå›¾â€ï¼Œ å¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æ•°æ®ç»“æ„

æ•°æ®ä¼ è¾“å½¢å¼
ä¸€ä¸ªç¨‹åºä¸­ï¼Œä¸åŒçš„ç®—å­å¯èƒ½å…·æœ‰ä¸åŒçš„å¹¶è¡Œåº¦
ç®—å­ä¹‹é—´ä¼ è¾“æ•°æ®çš„å½¢å¼å¯ä»¥æ˜¯one-to-one(forwarding)çš„æ¨¡å¼ä¹Ÿå¯ä»¥æ˜¯redistributingçš„æ¨¡å¼ï¼Œ å…·ä½“æ˜¯å“ªä¸€ç§å½¢å¼ï¼Œå–å†³äºç®—å­çš„ç§ç±»ã€‚
one-to-oneï¼šstreamç»´æŠ¤è€…åˆ†åŒºä»¥åŠå…ƒç´ çš„é¡ºåºï¼Œï¼ˆæ¯”å¦‚sourceå’Œmapä¹‹é—´ï¼‰ã€‚
    è¿™æ„å‘³ç€mapç®—å­çš„å­ä»»åŠ¡çœ‹åˆ°çš„å…ƒç´ ä¸ªæ•°ä»¥åŠé¡ºåºè·Ÿsourceç®—å­çš„å­ä»»åŠ¡ç”Ÿäº§çš„å…ƒç´ çš„ä¸ªæ•°ï¼Œé¡ºåºç›¸åŒã€‚
    mapã€filterã€flatMapç­‰ç®—å­éƒ½æ˜¯one-to-oneçš„å¯¹åº”å…³ç³»ã€‚
edistributing(é‡åˆ†åŒº)ï¼šstreamçš„åˆ†åŒºä¼šå‘ç”Ÿå˜åŒ–ã€‚æ¯ä¸€ä¸ªç®—å­çš„å­ä»»åŠ¡æ ¹æ®æ‰€é€‰æ‹©çš„transformationå‘é€æ•°æ®åˆ°ä¸åŒçš„ç›®æ ‡ä»»åŠ¡ã€‚
    ä¾‹å¦‚ï¼šKeyByåŸºäºhashCodeé‡åˆ†åŒºï¼Œè€Œbroadcastå’Œrebalanceä¼šéšæœºé‡æ–°åˆ†åŒºï¼Œè¿™äº›ç®—å­éƒ½ä¼šå¼•èµ·edistributeè¿‡ç¨‹ã€‚
    è€Œedistributeè¿‡ç¨‹å°±ç±»ä¼¼äºSparkä¸­çš„shuffleè¿‡ç¨‹

ä»»åŠ¡é“¾ï¼ˆOperator Chainï¼‰
Flinké‡‡ç”¨äº†ä¸€ç§ç§°ä¸ºä»»åŠ¡é“¾çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å‡å°‘æœ¬åœ°é€šä¿¡çš„å¼€é”€ã€‚ä¸ºäº†æ»¡è¶³ä»»åŠ¡è¿çš„è¦æ±‚ï¼Œå¿…é¡»å°†ä¸¤ä¸ªæˆ–å¤šä¸ªç®—å­è®¾ä¸ºç›¸åŒçš„å¹¶è¡Œåº¦ï¼Œ
å¹¶é€šè¿‡æœ¬åœ°è½¬å‘local forwardçš„æ–¹å¼è¿›è¡Œè¿æ¥ã€‚
ç›¸åŒå¹¶è¡Œåº¦çš„one-to-oneæ“ä½œï¼ŒFlinkè¿™æ ·ç›¸è¿çš„ç®—å­è¿æ¥åœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªtaskï¼ŒåŸæ¥çš„ç®—å­æˆä¸ºé‡Œé¢çš„subtask.
å¹¶è¡Œåº¦ç›¸åŒï¼Œå¹¶ä¸”æ˜¯one-to-oneæ“ä½œï¼Œä¸¤ä¸ªæ¡ä»¶ç¼ºä¸€ä¸å¯ã€‚

```

## Flink æµå¤„ç†API
```text
environment > source > transformation > sink
1ã€getExecutionEnvironment
    åˆ›å»ºä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œ è¡¨ç¤ºå½“å‰æ‰§è¡Œç¨‹åºçš„ä¸Šä¸‹æ–‡ã€‚å¦‚æœç¨‹åºæ˜¯ç‹¬ç«‹è°ƒç”¨çš„ï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›æœ¬åœ°æ‰§è¡Œç¯å¢ƒã€‚
    å¦‚æœä»å‘½ä»¤è¡Œå®¢æˆ·ç«¯è°ƒç”¨ç¨‹åºä»¥æäº¤åˆ°é›†ç¾¤ï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›æ­¤é›†ç¾¤çš„æ‰§è¡Œç¯å¢ƒï¼Œå³ï¼š
    getExecutionEnvironmentä¼šæ ¹æ®æŸ¥è¯¢è¿è¡Œçš„æ–¹å¼å†³å®šè¿”å›ä»€ä¹ˆæ ·çš„è¿è¡Œç¯å¢ƒï¼Œæ˜¯ä¸€ä¸­å¸¸ç”¨çš„åˆ›å»ºæ‰§è¡Œç¯å¢ƒçš„æ–¹å¼
    val env = StreamExecutionEnvironment.getExecutionEnvironment

Source

transformation

Flinkæ”¯æŒçš„æ•°æ®ç±»å‹:
Javaå’ŒScalaæ”¯æŒçš„æ‰€æœ‰åŸºç¡€æ•°æ®ç±»å‹
Javaå’ŒScalaå…ƒç»„
Scalaæ ·ä¾‹ç±»
Javaç®€å•å¯¹è±¡(POJOs)
ä»¥åŠArrays,Lists,Maps,Enums

å®ç°UDFå‡½æ•° -- æ›´ç»†ç²’åº¦çš„æ§åˆ¶æµ
å‡½æ•°ç±»(function classes)
Flinkæ›éœ²äº†æ‰€æœ‰udfå‡½æ•°çš„æ¥å£(å®ç°æ–¹å¼ä¸ºæ¥å£æˆ–è€…æŠ½è±¡ç±»)
åŒ¿åå‡½æ•°
å¯Œå‡½æ•°ï¼Œå¯ä»¥è·å–åˆ°è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ï¼Œè¿˜æœ‰ä¸€äº›ç”Ÿå‘½å‘¨æœŸ


Sink
Flinkè¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿï¼š
Kafka
Cassandra
Kinesis Streams
ES
Hadoop FileSystem
RabbitMQ
NiFi
Streaming API
Bahirï¼šä¸ºå¤§æ•°æ®å·¥å…·æä¾›è¿æ¥æ”¯æŒ



```

##  Flink jar
```text
<!-- Flinkä¾èµ–ï¼ˆJavaï¼‰ -->
    <dependency>
      <groupId>org.apache.flink</groupId>
      <artifactId>flink-java</artifactId>
      <version>1.10.1</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>org.apache.flink</groupId>
      <artifactId>flink-streaming-java_2.12</artifactId>
      <version>1.10.1</version>
      <scope>provided</scope>
    </dependency>
    <!-- Flinkä¾èµ–ï¼ˆScalaï¼‰ -->
    <dependency>
      <groupId>org.apache.flink</groupId>
      <artifactId>flink-scala_2.12</artifactId>
      <version>1.10.1</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>org.apache.flink</groupId>
      <artifactId>flink-streaming-scala_2.12</artifactId>
      <version>1.10.1</version>
      <scope>provided</scope>
    </dependency>
```
